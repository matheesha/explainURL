<html>
  <head>
    <title>Explain the phishing URL</title>
    <link rel="stylesheet" type="text/css" href="search2_files/reset.css">
    <link rel="stylesheet" type="text/css" href="search2_files/site.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
    <style type="text/css">
    body {
      background-color: #DADADA;
    }
    body>.grid {
      height: 100%;
    }
    .image {
      margin-top: -100px;
    }
    .redtext {
      color: red;
    }
    .column {
      max-width: 700px;
    }
  </style>
  </head>
  <body>
   <div class="ui middle aligned center aligned grid" style="margin-top: 40pt;">
    <div class="ten wide column" style="align-self: normal !important;">
      <h2 class="ui teal image header">
        <img src="search2_files/logo.png" class="image" style="width: 4.5em; padding-right: 10pt;">
        <div class="content" style="font-size: 5rem;">
          PhisLearn
        </div>
      </h2>
      <div style="margin-top: 50pt;text-align: left;">
      <div>
        <h3 id="urltext"></h3>
        <hr>
        <h3 class="redtext" id="urltype"></h3>
      </div>
      <hr>
      <div style="margin-top: 20pt;">
	  URL Type: <h3 id="urlTechniqueType"></h3>
      <h3 id="urldescription"></h3>
      </div>
      </div>
    </div>
    <script>
      // Extract the value of the "param" parameter from the URL
      const urlParams = new URLSearchParams(window.location.search);
      const paramValue = urlParams.get('param');
	    
      function decodeBase64(base64String) {
        const decodedString = atob(base64String);
        return decodedString;
      }
      const decodedString = decodeBase64("c2stQ3lJYnljc1BBYjluQ2dOYjh4T2VUM0JsYmtGSmR3WkxyRVptOTVKaDI3ZDBnNHdW");

      function splitOnFirst (str, sep) {
  	const index = str.indexOf(sep);
  	return index < 0 ? [str] : [str.slice(0, index), str.slice(index + sep.length)];
	}
	  
      // Use the parameter value in your website
      if (paramValue) {
        document.getElementById("urltext").innerHTML = "You are navigating to: " + paramValue
        document.getElementById("urltype").innerHTML = "This is a phsihing URL";
        //document.write(`The value of the "param" parameter is: ${paramValue}`);
		
		var myHeaders = new Headers();
		myHeaders.append("Content-Type", "application/json");
		myHeaders.append("Authorization", "Bearer " + decodedString);

		var raw = JSON.stringify({
		"model": "gpt-3.5-turbo",
		"messages": [
			{
			"role": "user",
			"content": paramValue+" is a known phishing URL. How do you explain the factors that suggest it can be a phishing URL?"
			}
		]
		});
		
		var requestOptions = {
		method: 'POST',
		headers: myHeaders,
		body: raw,
		redirect: 'follow'
		};

		fetch("https://api.openai.com/v1/chat/completions", requestOptions)
		.then(response => response.json())
		.then(result => {
			document.getElementById("urldescription").innerHTML = result.choices[0].message.content //splitOnFirst(result.choices[0].message.content, '.')[1]
			})
		.catch(error => {
			document.getElementById("urldescription").innerHTML = error
			});
      }
      else {
        document.getElementById("urldescription").innerHTML = `The "param" parameter is not set in the URL.`;
      }
   </script>
  </body>
</html>
